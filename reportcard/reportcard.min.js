var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var e=arguments[c];if(e)for(var d in e)$jscomp.owns(e,d)&&(a[d]=e[d])}return a};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var k=a[d];if(b.call(c,k,d,a))return{i:d,v:k}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,a){return $jscomp.findInternal(this,b,a).v}},"es6","es3");var $jscomp$destructuring$var0=require("resources/js/angular-app.js"),app=$jscomp$destructuring$var0.app;require("resources/js/airtable-service.js");require("resources/js/vietngu-service.js");require("./reportcard.scss");
(function(){var a=function(b,a,e,d,k,g,h){b.init=function(){b.dateFormat="yy-mm-dd";b.refresh=!1;Object.assign(b,h.pick(_config,"absentChoices","skillChoices","gradeChoices","commentChoices"));h.fixui();q();var a=b.authenticated||sessionStorage.getItem("authenticated"),l=location.pathname.split("/")[1];a?(b.authenticated=!0,c()):(sessionStorage.setItem("entryPage",location.pathname),location.href="/"+l+"/login/login.html")};b.view=function(a){m(a).then(function(a){b.report=a})};b.edit=function(a){m(a).then(function(a){b.report=
angular.copy(a);b.saved=!1;b.$watch("report",function(b){var f=$("#save-btn")[0];f&&(angular.equals(b,a)?f.classList.add("disabled"):f.classList.remove("disabled"))},!0);e.ready(function(){$("#datepicker-t1").datepicker(p());$("#datepicker-t2").datepicker(p())})})};b.submit=function(){var a=b.report.refId;(a?g.updateReport(a,b.report):g.createReport(b.report)).then(function(){b.reports.find(function(a){return a.oen===b.report.oen})||b.reports.push(b.report);b.saved=!0;location.hash="#!/view"})};b.clearDate=
function(a){delete b.report["date_"+a];delete b.report["signature_"+a]};b.print=function(){var a=require("html2canvas"),l=require("jspdf");a(document.getElementById("view"),{width:920}).then(function(a){a=a.toDataURL("image/jpeg");var f=new l;f.addImage(a,"JPEG",0,8,210,280);f.save(b.report.name+".pdf")})};b.popup=function(){var a=k.open({scope:b,templateUrl:"suggests.html",size:"lg",controller:function(){b.cancel=function(){a.close()};b.select=function(a){console.log(a)}}})};b.formatOEN=function(a){var b=
(a||"").replace(/\D/g,"").match(/^(\d{3})(\d{3})(\d*)$/);return b?b[1]+"-"+b[2]+"-"+b[3]:a};var c=function(){var f=a.defer();a.all([g.loadStudents(_config.lang),g.loadReports()]).then(function(a){b.students=a[0];b.reports=a[1];b.reports.forEach(function(a){n(a)});f.resolve()});return f.promise},m=function(f){var c=a.defer(),e=b.students.find(function(a){return a.oen===f}),d=b.reports.find(function(a){return a.oen===f});d?g.getReport(d.refId).then(function(a){n(a);c.resolve(a)}):(d={oen:e.oen,absent_1:"0"},
n(d),c.resolve(d));return c.promise},q=function(){b.report||(location.hash="#!/list",history.pushState(null,document.title,location.href));window.onhashchange=function(a){/\/view$/.test(a.newURL)&&/\/edit$/.test(a.oldURL)&&b.$apply(function(){b.refresh=!b.saved})};b.$watch("refresh",function(a){a&&(b.report&&b.report.oen?m(b.report.oen).then(function(a){b.report=a}):location.hash="#!/list",b.refresh=!a)})},n=function(a){!h.isEmpty(a.date_t1)&&(a.signature_t1=_config.signature);!h.isEmpty(a.date_t2)&&
(a.signature_t2=_config.signature);var c=b.students.find(function(b){return b.oen===a.oen});c&&(a.name=c.name);Object.assign(a,h.pick(_config,"lang","center","instructor"))},p=function(){return{dateFormat:b.dateFormat,onSelect:function(a,c){b.$apply(function(){var d=c.input[0].dataset.id;b.report["date_"+d]=a;b.report["signature_"+d]=_config.signature})}}}};a.$inject="$scope $q $document $location $uibModal VietNguService AppUtil".split(" ");app.controller("reportcard",a)})();
(function(){var a=function(a){var b=location.pathname.split("/")[1];a.when("/view",{templateUrl:"/"+b+"/reportcard/view.html"}).when("/edit",{templateUrl:"/"+b+"/reportcard/edit.html"}).otherwise({templateUrl:"/"+b+"/reportcard/list.html"})};a.$inject=["$routeProvider"];app.config(a)})();
